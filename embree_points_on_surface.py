points=[[691510.9771545762, 5335544.318156727, 534.4835291078773], [691507.1713207796, 5335530.4311395865, 534.736870022351], [691524.724164552, 5335604.489309301, 535.3155183429727], [691405.0428625006, 5335288.934817821, 534.1104931890134], [691395.0849848647, 5335284.021784775, 532.1466017490401], [691385.2963572078, 5335279.766213482, 531.5735295045857], [691375.5505314105, 5335275.536045623, 531.0873729072164], [691365.7839664681, 5335271.33452304, 530.5090810316314], [691356.0736242856, 5335267.055333124, 530.1235363406785], [691346.5265738731, 5335262.550574331, 530.1580869384898], [691336.9074557559, 5335258.145364362, 530.0072839967619], [691511.1701504533, 5335544.051558677, 534.98], [691507.2658340412, 5335530.300582129, 534.98], [691524.7283929022, 5335604.483468399, 535.3263955325785], [691407.9924461577, 5335284.860361615, 541.6981290051199], [691395.0849848645, 5335284.021784775, 532.1466017484362], [691389.113097571, 5335274.493896008, 541.3918765146955], [691375.5505314106, 5335275.536045623, 531.0873729074843], [691365.7839664682, 5335271.33452304, 530.5090810319207], [691356.0736242854, 5335267.055333124, 530.1235363399734], [691346.526573873, 5335262.550574331, 530.1580869381065], [691336.907455756, 5335258.145364362, 530.0072839969296], [691514.0101456597, 5335540.128484292, 542.2857257736721], [691510.2041998394, 5335526.2416218985, 542.538778513718], [691524.7283929023, 5335604.483468399, 535.3263955328612], [691395.0849848643, 5335284.021784775, 532.1466017479756], [691375.5505314107, 5335275.536045623, 531.0873729076812], [691365.7839664683, 5335271.33452304, 530.5090810321387], [691356.0736242852, 5335267.055333124, 530.1235363394208], [691346.5265738729, 5335262.550574331, 530.1580869377995], [691336.9074557561, 5335258.145364362, 530.0072839970202], [691514.0101456596, 5335540.128484292, 542.2857257734149], [691510.2396608725, 5335526.1926372135, 542.63], [691524.7283929024, 5335604.483468399, 535.3263955332139], [691395.0849848642, 5335284.021784775, 532.1466017475867], [691375.5505314108, 5335275.536045623, 531.0873729078072], [691365.7839664684, 5335271.33452304, 530.5090810322856], [691356.073624285, 5335267.055333124, 530.1235363390206], [691346.5265738728, 5335262.550574331, 530.1580869375687], [691336.9074557561, 5335258.145364362, 530.0072839970338], [691514.0101456596, 5335540.128484292, 542.285725773375], [691524.7283929026, 5335604.483468399, 535.3263955336369], [691395.0849848641, 5335284.021784775, 532.1466017472695], [691375.5505314108, 5335275.536045623, 531.0873729078621], [691365.7839664684, 5335271.33452304, 530.5090810323612], [691356.0736242849, 5335267.055333124, 530.1235363386967], [691346.5265738728, 5335262.550574331, 530.1580869374142], [691336.9074557561, 5335258.145364362, 530.0072839970475], [691514.0101456596, 5335540.128484292, 542.2857257733351], [691524.7283929029, 5335604.483468399, 535.3263955342002], [691395.084984864, 5335284.021784775, 532.1466017470241], [691375.5505314108, 5335275.536045623, 531.087372907917], [691365.7839664684, 5335271.33452304, 530.5090810324368], [691356.0736242848, 5335267.055333124, 530.1235363384491], [691346.5265738728, 5335262.550574331, 530.1580869372597], [691336.9074557561, 5335258.145364362, 530.0072839970611], [691514.0101456596, 5335540.128484292, 542.2857257732952], [691524.7283929032, 5335604.483468398, 535.3263955349038], [691395.084984864, 5335284.021784775, 532.1466017468503], [691375.5505314108, 5335275.536045623, 531.0873729079719], [691365.7839664684, 5335271.33452304, 530.5090810325124], [691356.0736242848, 5335267.055333124, 530.1235363382776], [691346.5265738728, 5335262.550574331, 530.1580869371052], [691336.9074557561, 5335258.145364362, 530.0072839970748], [691514.0101456596, 5335540.128484292, 542.2857257732553], [691524.7283929028, 5335604.483468399, 535.3263955336772], [691395.084984864, 5335284.021784775, 532.1466017466764], [691375.5505314108, 5335275.536045623, 531.0873729080269], [691365.7839664684, 5335271.33452304, 530.509081032588], [691356.0736242848, 5335267.055333124, 530.1235363381062], [691346.5265738728, 5335262.550574331, 530.1580869369507], [691336.9074557561, 5335258.145364362, 530.0072839970884], [691514.0101456596, 5335540.128484292, 542.2857257732154], [691524.728392903, 5335604.483468398, 535.3263955343107], [691395.084984864, 5335284.021784775, 532.1466017465026], [691375.5505314108, 5335275.536045623, 531.0873729080818], [691365.7839664684, 5335271.33452304, 530.5090810326636], [691356.0736242848, 5335267.055333124, 530.1235363379348], [691346.5265738728, 5335262.550574331, 530.1580869367962], [691336.9074557561, 5335258.145364362, 530.007283997102], [691514.0101456596, 5335540.128484292, 542.2857257731755], [691524.7283929025, 5335604.483468399, 535.3263955329437], [691395.084984864, 5335284.021784775, 532.1466017463288], [691375.5505314108, 5335275.536045623, 531.0873729081367], [691365.7839664684, 5335271.33452304, 530.5090810327392], [691356.0736242848, 5335267.055333124, 530.1235363377633], [691346.5265738728, 5335262.550574331, 530.1580869366417], [691336.9074557561, 5335258.145364362, 530.0072839971157], [691514.0101456596, 5335540.128484292, 542.2857257731356], [691524.7283929028, 5335604.483468399, 535.3263955334368], [691395.084984864, 5335284.021784775, 532.1466017461549], [691375.5505314108, 5335275.536045623, 531.0873729081916], [691365.7839664684, 5335271.33452304, 530.5090810328148], [691356.0736242848, 5335267.055333124, 530.1235363375919], [691346.5265738728, 5335262.550574331, 530.1580869364872], [691336.9074557561, 5335258.145364362, 530.0072839971293], [691514.0101456596, 5335540.128484292, 542.2857257730957], [691524.728392903, 5335604.483468398, 535.3263955340702], [691395.084984864, 5335284.021784775, 532.1466017459811], [691375.5505314108, 5335275.536045623, 531.0873729082465], [691365.7839664684, 5335271.33452304, 530.5090810328904], [691356.0736242848, 5335267.055333124, 530.1235363374204], [691346.5265738728, 5335262.550574331, 530.1580869363327], [691336.9074557561, 5335258.145364362, 530.007283997143], [691514.0101456596, 5335540.128484292, 542.2857257730558], [691524.7283929025, 5335604.483468399, 535.3263955327033], [691395.084984864, 5335284.021784775, 532.1466017458073], [691375.5505314108, 5335275.536045623, 531.0873729083014], [691365.7839664684, 5335271.33452304, 530.509081032966], [691356.0736242848, 5335267.055333124, 530.123536337249], [691346.5265738728, 5335262.550574331, 530.1580869361782], [691336.9074557561, 5335258.145364362, 530.0072839971566], [691514.0101456596, 5335540.128484292, 542.2857257730159], [691524.7283929028, 5335604.483468399, 535.3263955331963], [691395.084984864, 5335284.021784775, 532.1466017456335], [691375.5505314108, 5335275.536045623, 531.0873729083563], [691365.7839664684, 5335271.33452304, 530.5090810330416], [691356.0736242848, 5335267.055333124, 530.1235363370776], [691346.5265738728, 5335262.550574331, 530.1580869360237], [691336.9074557561, 5335258.145364362, 530.0072839971702], [691514.0101456596, 5335540.128484292, 542.285725772976], [691524.728392903, 5335604.483468398, 535.3263955338298], [691395.084984864, 5335284.021784775, 532.1466017454596], [691375.5505314108, 5335275.536045623, 531.0873729084112], [691365.7839664684, 5335271.33452304, 530.5090810331172], [691356.0736242848, 5335267.055333124, 530.1235363369061], [691346.5265738728, 5335262.550574331, 530.1580869358692], [691336.9074557561, 5335258.145364362, 530.0072839971839], [691514.0101456596, 5335540.128484292, 542.2857257729361], [691524.7283929025, 5335604.483468399, 535.3263955324628], [691395.084984864, 5335284.021784775, 532.1466017452858], [691375.5505314108, 5335275.536045623, 531.0873729084661], [691365.7839664684, 5335271.33452304, 530.5090810331928], [691356.0736242848, 5335267.055333124, 530.1235363367347], [691346.5265738728, 5335262.550574331, 530.1580869357147], [691336.9074557561, 5335258.145364362, 530.0072839971975], [691514.0101456596, 5335540.128484292, 542.2857257728962], [691524.7283929028, 5335604.483468399, 535.3263955329559], [691395.084984864, 5335284.021784775, 532.146601745112], [691375.5505314108, 5335275.536045623, 531.087372908521], [691365.7839664684, 5335271.33452304, 530.5090810332684], [691356.0736242848, 5335267.055333124, 530.1235363365632], [691346.5265738728, 5335262.550574331, 530.1580869355602], [691336.9074557561, 5335258.145364362, 530.0072839972112], [691514.0101456596, 5335540.128484292, 542.2857257728563], [691524.728392903, 5335604.483468398, 535.3263955335893], [691395.084984864, 5335284.021784775, 532.1466017449382], [691375.5505314108, 5335275.536045623, 531.087372908576], [691365.7839664684, 5335271.33452304, 530.509081033344], [691356.0736242848, 5335267.055333124, 530.1235363363918], [691346.5265738728, 5335262.550574331, 530.1580869354057], [691336.9074557561, 5335258.145364362, 530.0072839972248], [691514.0101456596, 5335540.128484292, 542.2857257728164], [691524.7283929025, 5335604.483468399, 535.3263955322224], [691395.084984864, 5335284.021784775, 532.1466017447643], [691375.5505314108, 5335275.536045623, 531.0873729086309], [691365.7839664684, 5335271.33452304, 530.5090810334196], [691356.0736242848, 5335267.055333124, 530.1235363362204], [691346.5265738728, 5335262.550574331, 530.1580869352512], [691336.9074557561, 5335258.145364362, 530.0072839972385], [691514.0101456596, 5335540.128484292, 542.2857257727765], [691524.7283929028, 5335604.483468399, 535.3263955327154], [691395.084984864, 5335284.021784775, 532.1466017445905], [691375.5505314108, 5335275.536045623, 531.0873729086858], [691365.7839664684, 5335271.33452304, 530.5090810334952], [691356.0736242848, 5335267.055333124, 530.1235363360489], [691346.5265738728, 5335262.550574331, 530.1580869350967], [691336.9074557561, 5335258.145364362, 530.0072839972521]]
import trimesh
import numpy as np
from scipy.spatial import cKDTree
import pandas as pd
from pyproj import Proj, transform
from pyproj import Transformer
transformer = Transformer.from_crs("EPSG:4326", "EPSG:25832")
from data_process import *
# df = pd.read_csv(r"C:\Users\Morning\Downloads\munich_trans_facade_samples\munich_trans_facade_samples.csv")
# df['Floor'] = df['Floor'] * 2.4 + 522.5
# 用列的均值替换NaN值
collect_origins=[]
def convert(latitude, longitude):
    # print(latitude,longitude)
    return transformer.transform(longitude, latitude)
for i in range(40):
    # print(data[i])

    points.append([*convert(data_ori[i][0], data_ori[i][1]), data_ori[i][2]-45])
# selected_columns = df[['join_xcoor', 'join_ycoor', 'Floor']]
# line_list_data=selected_columns.values.tolist()
# 定义 EPSG:25832 坐标系

# 转换函数
def transform_coordinates(points, src_proj, dst_proj):
    transformed_points = np.array([transform(src_proj, dst_proj, x, y) for x, y in points])
    return transformed_points

# 示例 EPSG:25832 点坐标
epsg25832_points =   np.array(points)
obj_mesh = trimesh.load(r'q.obj')
obj_vertices = obj_mesh.vertices
obj_faces = obj_mesh.faces
tree = cKDTree(obj_vertices)
# 将 EPSG:25832 坐标转换为 WGS84 坐标
# transformed_points = transform_coordinates(epsg25832_points, epsg25832, wgs84)
colors = np.array([[255, 0, 0, 255] for _ in range(len(epsg25832_points))])  # RGBA 格式

# 创建点云
# point_cloud = trimesh.points.PointCloud(epsg25832_points, colors=colors)

# 加载 OBJ 文件


distances, indices = tree.query(epsg25832_points, distance_upper_bound=100.0)
height=[]
num_correct=0
contained=obj_mesh.contains(points)

for i,( point, is_contained )in enumerate(zip(points, contained)):
    if is_contained:

        colors[i] = [128, 0, 128, 255]  # 紫色
        num_correct+=1


        # min_obj_height = np.min(obj_vertices[obj_vertices[:, 0] == obj_vertices[idx, 0], 2])
        # height.append(min_obj_height)
        # epsg25832_points[i, 2] = min_obj_height
print(height)
# 创建点云
point_cloud = trimesh.points.PointCloud(epsg25832_points, colors=colors)

# 创建场景
scene = trimesh.Scene()
scene.add_geometry(point_cloud)
scene.add_geometry(obj_mesh)

# 显示场景
scene.show()